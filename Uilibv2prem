--[=[
 d888b  db    db d888888b      .d888b.      db      db    db  .d8b.  
88' Y8b 88    88   `88'        VP  `8D      88      88    88 d8' `8b 
88      88    88    88            odD'      88      88    88 88ooo88 
88  ooo 88    88    88          .88'        88      88    88 88~~~88 
88. ~8~ 88b  d88   .88.        j88.         88booo. 88b  d88 88   88    @uniquadev
 Y888P  ~Y8888P' Y888888P      888888D      Y88888P ~Y8888P' YP   YP  OSER UI LIBRARY
]=]

local OserUI = {}
OserUI.__index = OserUI

local UserInputService = game:GetService("UserInputService")
local TweenService = game:GetService("TweenService")
local Players = game:GetService("Players")

local ANIMATION_SPEED = 0.3
local TWEEN_INFO = TweenInfo.new(ANIMATION_SPEED, Enum.EasingStyle.Quad, Enum.EasingDirection.InOut)

-- Tạo UI Library mới
function OserUI.new(config)
	local self = setmetatable({}, OserUI)
	
	config = config or {}
	self.Position = config.Position or UDim2.new(0.32026, 0, -0.09486, 0)
	self.Size = config.Size or UDim2.new(0.46025, 0, 1.06155, 0)
	self.BackgroundColor = config.BackgroundColor or Color3.fromRGB(0, 36, 255)
	self.BorderColor = config.BorderColor or Color3.fromRGB(0, 36, 255)
	self.BackgroundTransparency = config.BackgroundTransparency or 0.5
	
	self.isOpen = true
	self.isAnimating = false
	self.isDragging = false
	
	self:_createUI()
	
	return self
end

function OserUI:_createUI()
	-- ScreenGui
	self.ScreenGui = Instance.new("ScreenGui", Players.LocalPlayer:WaitForChild("PlayerGui"))
	self.ScreenGui.SafeAreaCompatibility = Enum.SafeAreaCompatibility.None
	self.ScreenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
	
	-- Main Frame (OserUI)
	self.OserUI = Instance.new("Frame", self.ScreenGui)
	self.OserUI.Active = true
	self.OserUI.BorderSizePixel = 0
	self.OserUI.BackgroundColor3 = self.BackgroundColor
	self.OserUI.BackgroundTransparency = self.BackgroundTransparency
	self.OserUI.Size = self.Size
	self.OserUI.Position = self.Position
	self.OserUI.Name = "OserUI"
	self.OserUI.SelectionGroup = true
	
	-- UICorner
	local corner = Instance.new("UICorner", self.OserUI)
	corner.CornerRadius = UDim.new(0, 4)
	
	-- UIStroke
	local stroke = Instance.new("UIStroke", self.OserUI)
	stroke.Thickness = 0.5
	stroke.Color = self.BorderColor
	
	-- Folder chứa các UI con
	self.OserFolder = Instance.new("Folder", self.OserUI)
	self.OserFolder.Name = "OserFolder"
	
	-- Main Content Frame
	self.OserGroup = Instance.new("Frame", self.OserFolder)
	self.OserGroup.BorderSizePixel = 0
	self.OserGroup.BackgroundColor3 = Color3.fromRGB(51, 36, 255)
	self.OserGroup.BackgroundTransparency = 0.9
	self.OserGroup.Size = UDim2.new(0.8625, 0, 0.99149, 0)
	self.OserGroup.Position = UDim2.new(0, 64, 0, 2)
	self.OserGroup.Name = "OserGroup"
	
	-- ScrollingFrame
	self.OserScroling = Instance.new("Folder", self.OserUI)
	self.OserScroling.Name = "OserScroling"
	
	self.ScrollingFrame = Instance.new("ScrollingFrame", self.OserScroling)
	self.ScrollingFrame.Active = true
	self.ScrollingFrame.BorderSizePixel = 0
	self.ScrollingFrame.BackgroundColor3 = Color3.fromRGB(51, 31, 255)
	self.ScrollingFrame.BackgroundTransparency = 0.9
	self.ScrollingFrame.Size = UDim2.new(0.125, 0, 0.88085, 0)
	self.ScrollingFrame.Position = UDim2.new(0, 2, 0, 54)
	self.ScrollingFrame.ScrollBarThickness = 3
	
	-- Header (Icon + Title)
	self.IconOser = Instance.new("Frame", self.OserFolder)
	self.IconOser.BorderSizePixel = 0
	self.IconOser.BackgroundTransparency = 1
	self.IconOser.Size = UDim2.new(0.125, 0, 0.10638, 0)
	self.IconOser.Position = UDim2.new(0, 2, 0, 2)
	self.IconOser.Name = "IconOser"
	
	local iconCorner = Instance.new("UICorner", self.IconOser)
	iconCorner.CornerRadius = UDim.new(0, 4)
	
	local iconImage = Instance.new("ImageLabel", self.IconOser)
	iconImage.BorderSizePixel = 0
	iconImage.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
	iconImage.Size = UDim2.new(1, 0, 1, 0)
	
	-- Top Buttons
	self:_createTopButtons()
	
	-- Drag Script
	self:_setupDrag()
	
	-- Toggle Button
	self:_setupToggle()
	
	-- Resize Script
	self:_setupResize()
end

function OserUI:_createTopButtons()
	-- Setting Button
	self.SettingUi = Instance.new("Frame", self.OserUI)
	self.SettingUi.Active = true
	self.SettingUi.BorderSizePixel = 0
	self.SettingUi.BackgroundTransparency = 1
	self.SettingUi.Size = UDim2.new(0.0625, 0, 0.06383, 0)
	self.SettingUi.Position = UDim2.new(0.92708, 0, 0, 0)
	self.SettingUi.Name = "SettingUi"
	
	local settingBtn = Instance.new("ImageButton", self.SettingUi)
	settingBtn.BorderSizePixel = 0
	settingBtn.BackgroundTransparency = 1
	settingBtn.Size = UDim2.new(1.5, 0, 1.5, 0)
	settingBtn.Position = UDim2.new(0.53333, 0, 0.46667, 0)
	
	-- Info Button
	self.InfoUi = Instance.new("Frame", self.OserUI)
	self.InfoUi.Active = true
	self.InfoUi.BorderSizePixel = 0
	self.InfoUi.BackgroundTransparency = 1
	self.InfoUi.Size = UDim2.new(0.0625, 0, 0.06383, 0)
	self.InfoUi.Position = UDim2.new(0.82292, 0, 0, 0)
	self.InfoUi.Name = "InfoUi"
	
	local infoBtn = Instance.new("ImageButton", self.InfoUi)
	infoBtn.BorderSizePixel = 0
	infoBtn.BackgroundTransparency = 1
	infoBtn.Size = UDim2.new(1.5, 0, 1.5, 0)
	infoBtn.Position = UDim2.new(0.53333, 0, 0.46667, 0)
end

function OserUI:_setupDrag()
	local dragging = false
	local dragStart
	local startPos
	
	self.OserUI.InputBegan:Connect(function(input)
		if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
			dragging = true
			dragStart = input.Position
			startPos = self.OserUI.Position
			
			input.Changed:Connect(function()
				if input.UserInputState == Enum.UserInputState.End then
					dragging = false
				end
			end)
		end
	end)
	
	UserInputService.InputChanged:Connect(function(input)
		if dragging and (input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch) then
			local delta = input.Position - dragStart
			local newPos = UDim2.new(
				startPos.X.Scale,
				startPos.X.Offset + delta.X,
				startPos.Y.Scale,
				startPos.Y.Offset + delta.Y
			)
			
			local tween = TweenService:Create(self.OserUI, TWEEN_INFO, {Position = newPos})
			tween:Play()
		end
	end)
end

function OserUI:_setupToggle()
	-- Tạo button toggle
	self.HideUI = Instance.new("Frame", self.ScreenGui)
	self.HideUI.Name = "HideUI"
	self.HideUI.BackgroundTransparency = 1
	self.HideUI.Size = UDim2.new(0, 50, 0, 50)
	self.HideUI.Position = UDim2.new(0, 10, 0, 10)
	
	local toggleBtn = Instance.new("ImageButton", self.HideUI)
	toggleBtn.Name = "ToggleButton"
	toggleBtn.Size = UDim2.new(1, 0, 1, 0)
	toggleBtn.BackgroundColor3 = Color3.fromRGB(0, 36, 255)
	toggleBtn.BorderSizePixel = 0
	
	local btnCorner = Instance.new("UICorner", toggleBtn)
	btnCorner.CornerRadius = UDim.new(1, 0)
	
	toggleBtn.MouseButton1Click:Connect(function()
		self:toggle()
	end)
end

function OserUI:toggle()
	if self.isAnimating then return end
	
	self.isAnimating = true
	self.isOpen = not self.isOpen
	
	if self.isOpen then
		-- Mở UI
		self.OserUI.Visible = true
		local tween = TweenService:Create(self.OserUI, TWEEN_INFO, {
			Size = self.Size,
			Position = self.Position,
			BackgroundTransparency = self.BackgroundTransparency
		})
		tween:Play()
		tween.Completed:Connect(function()
			self.isAnimating = false
		end)
	else
		-- Đóng UI
		local tween = TweenService:Create(self.OserUI, TWEEN_INFO, {
			Size = UDim2.new(self.Size.X.Scale * 0.9, self.Size.X.Offset, self.Size.Y.Scale * 0.9, self.Size.Y.Offset),
			Position = UDim2.new(self.Position.X.Scale + 0.05, self.Position.X.Offset, self.Position.Y.Scale + 0.05, self.Position.Y.Offset),
			BackgroundTransparency = 1
		})
		tween:Play()
		tween.Completed:Connect(function()
			self.OserUI.Visible = false
			self.isAnimating = false
		end)
	end
end

function OserUI:_setupResize()
	local resizeHandle = Instance.new("ImageLabel", self.OserGroup)
	resizeHandle.Name = "ResizeHandle"
	resizeHandle.BackgroundColor3 = Color3.fromRGB(200, 200, 200)
	resizeHandle.BorderSizePixel = 0
	resizeHandle.Size = UDim2.new(0, 15, 0, 15)
	resizeHandle.Position = UDim2.new(1, -15, 1, -15)
	resizeHandle.ZIndex = 100
	
	local isDragging = false
	local startSize
	local startX, startY
	local mouse = Players.LocalPlayer:GetMouse()
	
	resizeHandle.InputBegan:Connect(function(input)
		if input.UserInputType == Enum.UserInputType.MouseButton1 then
			isDragging = true
			startSize = self.OserUI.Size
			startX = mouse.X
			startY = mouse.Y
		end
	end)
	
	resizeHandle.InputEnded:Connect(function(input)
		if input.UserInputType == Enum.UserInputType.MouseButton1 then
			isDragging = false
		end
	end)
	
	UserInputService.InputChanged:Connect(function(input)
		if not isDragging or input.UserInputType ~= Enum.UserInputType.MouseMovement then return end
		
		local deltaX = mouse.X - startX
		local deltaY = mouse.Y - startY
		
		local newWidth = math.max(200, startSize.X.Offset + deltaX)
		local newHeight = math.max(200, startSize.Y.Offset + deltaY)
		
		local scaleX = newWidth / startSize.X.Offset
		local scaleY = newHeight / startSize.Y.Offset
		
		self.OserUI.Size = UDim2.new(startSize.X.Scale, newWidth, startSize.Y.Scale, newHeight)
		
		-- Scale tất cả con
		for _, child in pairs(self.OserUI:GetDescendants()) do
			if child:IsA("GuiObject") then
				if child.Size.X.Offset > 0 then
					child.Size = UDim2.new(
						child.Size.X.Scale,
						child.Size.X.Offset * scaleX,
						child.Size.Y.Scale,
						child.Size.Y.Offset * scaleY
					)
				end
				
				if child.Position.X.Offset > 0 or child.Position.Y.Offset > 0 then
					child.Position = UDim2.new(
						child.Position.X.Scale,
						child.Position.X.Offset * scaleX,
						child.Position.Y.Scale,
						child.Position.Y.Offset * scaleY
					)
				end
				
				if child:IsA("TextLabel") or child:IsA("TextButton") then
					child.TextSize = math.max(8, child.TextSize * ((scaleX + scaleY) / 2))
				end
			end
		end
	end)
end

-- Thêm nút vào ScrollingFrame
function OserUI:addButton(name, size, callback)
	local button = Instance.new("TextButton", self.ScrollingFrame)
	button.Name = name
	button.Text = name
	button.Size = size or UDim2.new(0.2, 0, 0.3, 0)
	button.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
	button.BorderSizePixel = 0
	
	if callback then
		button.MouseButton1Click:Connect(callback)
	end
	
	return button
end

-- Lấy OserUI Frame
function OserUI:getMainFrame()
	return self.OserUI
end

-- Lấy Content Group
function OserUI:getContentFrame()
	return self.OserGroup
end

return OserUI
