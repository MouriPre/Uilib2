local TweenService = game:GetService("TweenService")
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")
local Players = game:GetService("Players")

local RadarUI = {}
RadarUI.__index = RadarUI

-- Utility Functions
local function CreateTween(instance, props, time, style, dir)
    local info = TweenInfo.new(time or 0.5, style or Enum.EasingStyle.Quart, dir or Enum.EasingDirection.Out)
    local tween = TweenService:Create(instance, info, props)
    return tween
end

function RadarUI.new(title)
    local ui = {}
    setmetatable(ui, RadarUI)
    
    -- Main GUI
    ui.ScreenGui = Instance.new("ScreenGui")
    ui.ScreenGui.Name = "RadarUI"
    ui.ScreenGui.ResetOnSpawn = false
    ui.ScreenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
    
    -- Detect if on mobile
    local isMobile = UserInputService.TouchEnabled and not UserInputService.MouseEnabled
    
    -- Toggle Button (Fixed position)
    ui.ToggleButton = Instance.new("ImageButton")
    ui.ToggleButton.Size = UDim2.new(0, 50, 0, 50)
    ui.ToggleButton.Position = UDim2.new(0, 10, 0.5, -25)  -- Left center
    ui.ToggleButton.BackgroundColor3 = Color3.fromRGB(30, 30, 35)
    ui.ToggleButton.BorderSizePixel = 0
    ui.ToggleButton.Image = "rbxassetid://3926307971"  -- Power icon
    ui.ToggleButton.ImageRectOffset = Vector2.new(324, 364)
    ui.ToggleButton.ImageRectSize = Vector2.new(36, 36)
    ui.ToggleButton.ImageColor3 = Color3.fromRGB(255, 255, 255)
    ui.ToggleButton.Parent = ui.ScreenGui
    
    -- Add glow to toggle button
    local ToggleGlow = Instance.new("ImageLabel")
    ToggleGlow.Size = UDim2.new(1.5, 0, 1.5, 0)
    ToggleGlow.Position = UDim2.new(0.5, 0, 0.5, 0)
    ToggleGlow.AnchorPoint = Vector2.new(0.5, 0.5)
    ToggleGlow.BackgroundTransparency = 1
    ToggleGlow.Image = "rbxassetid://4996891970"  -- Glow texture
    ToggleGlow.ImageColor3 = Color3.fromRGB(45, 100, 255)
    ToggleGlow.ImageTransparency = 0.5
    ToggleGlow.Parent = ui.ToggleButton
    
    -- Add corners to toggle button
    local ToggleCorner = Instance.new("UICorner")
    ToggleCorner.CornerRadius = UDim.new(0, 25)
    ToggleCorner.Parent = ui.ToggleButton
    
    -- Main Container (Responsive size)
    ui.MainFrame = Instance.new("Frame")
    ui.MainFrame.Name = "MainContainer"
    if isMobile then
        ui.MainFrame.Size = UDim2.new(0.95, 0, 0.6, 0)
        ui.MainFrame.Position = UDim2.new(0.5, 0, 0.3, 0)
    else
        ui.MainFrame.Size = UDim2.new(0, 800, 0, 500)
        ui.MainFrame.Position = UDim2.new(0.5, -400, 0.5, -250)
    end
    ui.MainFrame.BackgroundColor3 = Color3.fromRGB(20, 20, 25)
    ui.MainFrame.BorderSizePixel = 0
    ui.MainFrame.ClipsDescendants = true
    ui.MainFrame.AnchorPoint = Vector2.new(0.5, 0.5)
    ui.MainFrame.Parent = ui.ScreenGui
    
    -- Add Blur Effect
    local BlurEffect = Instance.new("BlurEffect")
    BlurEffect.Size = 20
    BlurEffect.Parent = game:GetService("Lighting")
    BlurEffect.Enabled = false
    
    -- Add Glow
    local GlowFrame = Instance.new("ImageLabel")
    GlowFrame.Size = UDim2.new(1.1, 0, 1.1, 0)
    GlowFrame.Position = UDim2.new(0.5, 0, 0.5, 0)
    GlowFrame.AnchorPoint = Vector2.new(0.5, 0.5)
    GlowFrame.BackgroundTransparency = 1
    GlowFrame.Image = "rbxassetid://4996891970"
    GlowFrame.ImageColor3 = Color3.fromRGB(45, 100, 255)
    GlowFrame.ImageTransparency = 0.5
    GlowFrame.Parent = ui.MainFrame
    
    -- Rest of your UI elements...
    -- [Previous code for TopBar, Title, ContentFrame, etc.]
    
    -- Toggle Logic
    local isUIOpen = true
    ui.ToggleButton.MouseButton1Click:Connect(function()
        isUIOpen = not isUIOpen
        
        -- Animate toggle button
        local rotation = isUIOpen and 0 or 180
        local color = isUIOpen and Color3.fromRGB(45, 100, 255) or Color3.fromRGB(255, 255, 255)
        CreateTween(ui.ToggleButton, {Rotation = rotation}, 0.3):Play()
        CreateTween(ui.ToggleButton.ImageLabel, {ImageColor3 = color}, 0.3):Play()
        
        -- Animate main UI
        if isUIOpen then
            BlurEffect.Enabled = true
            ui.MainFrame.Visible = true
            if isMobile then
                CreateTween(ui.MainFrame, {
                    Size = UDim2.new(0.95, 0, 0.6, 0),
                    Position = UDim2.new(0.5, 0, 0.3, 0),
                    BackgroundTransparency = 0
                }, 0.3):Play()
            else
                CreateTween(ui.MainFrame, {
                    Size = UDim2.new(0, 800, 0, 500),
                    Position = UDim2.new(0.5, -400, 0.5, -250),
                    BackgroundTransparency = 0
                }, 0.3):Play()
            end
            CreateTween(GlowFrame, {ImageTransparency = 0.5}, 0.3):Play()
        else
            CreateTween(ui.MainFrame, {
                Size = UDim2.new(0, 0, 0, 0),
                Position = UDim2.new(0.5, 0, 0.5, 0),
                BackgroundTransparency = 1
            }, 0.3).Completed:Connect(function()
                ui.MainFrame.Visible = false
                BlurEffect.Enabled = false
            end)
            CreateTween(GlowFrame, {ImageTransparency = 1}, 0.3):Play()
        end
    end)
    
    -- Add hover effect to toggle button
    ui.ToggleButton.MouseEnter:Connect(function()
        CreateTween(ui.ToggleButton, {BackgroundColor3 = Color3.fromRGB(45, 45, 50)}, 0.2):Play()
    end)
    
    ui.ToggleButton.MouseLeave:Connect(function()
        CreateTween(ui.ToggleButton, {BackgroundColor3 = Color3.fromRGB(30, 30, 35)}, 0.2):Play()
    end)
    
    -- Initial state
    if not isUIOpen then
        ui.MainFrame.Visible = false
        ui.MainFrame.Size = UDim2.new(0, 0, 0, 0)
        ui.MainFrame.Position = UDim2.new(0.5, 0, 0.5, 0)
        ui.MainFrame.BackgroundTransparency = 1
        GlowFrame.ImageTransparency = 1
        BlurEffect.Enabled = false
        ui.ToggleButton.Rotation = 180
    end
    
    ui.ScreenGui.Parent = game:GetService("CoreGui")
    
    return ui
end

return RadarUI
